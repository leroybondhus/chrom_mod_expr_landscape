---
title: "AN_HumanProteinAtlas_Analyses"
author: "Aileen Nava"
date: '2023-11-26'
output: html_document
---
#objective:
#data source:



#Attempt1 - Plots of subcell distribution for all epigenes or just those that cause chromatinopathies.
  #step1> pulling subcellular localization from HPA for all epigenes.
```{r}

#(0) load libraries
library(readr)
library(tidyverse)

#(1) read in 720 epigenes with chromatinopathy annotations:
  epigenes<-read.csv(file="AN_curated_chromopathy_LB_mod.csv")

#(2) read in subcellular location data + rename ensemble column for overlap:
  #ref: https://community.rstudio.com/t/using-readrs-read-tsv-to-read-a-zip-compressed-tsv-file-from-a-url/26332

  url <- "https://www.proteinatlas.org/download/subcellular_location.tsv.zip"
  zip_file <- tempfile(fileext = ".zip")
  download.file(url, zip_file, mode = "wb")
  
  subcell <- read_tsv(zip_file)
  subcell <- data.frame(subcell)
  subcell <- subcell%>%dplyr::rename(ensembl_gene_id=Gene)

#(3) combine epigene list with subcellular location annotations:
  epigenes<- dplyr::left_join(epigenes,subcell, by="ensembl_gene_id")


#(4) plot ALL unique epigenes: select columns needed only for visualization
  PLOTall_eg<-epigenes%>%dplyr::select(ensembl_gene_id,
                                             hgnc_symbol,
                                             "Main.location",
                                             "Additional.location",
                                             "Extracellular.location")%>%unique()
  PLOTall_eg<-PLOTall_eg%>%tidyr::replace_na(list("Main.location" = "No info available",
                                                              "Additional.location" = "No info available",
                                                              "Extracellular.location"="No info available"))
  
  
  
  
  
#(5) plot ALL unique epigenes: collapse nucleus sub-compartments 
  #57 unique main.locations are found in "PLOTall_eg", but a majority are related to nucleus subcompartments.
  #will collapse nucleus sub-compartments into "nucleus"
  
  
  
  PLOTall_eg_nucleus<-
  
  
    
    
    
    
  
#remove useless variables
  rm(url,zip_file)

```





#Attempt1 - pulling protein domains from HPA for all epigenes.
```{r}


# Install and load the required packages
if (!requireNamespace("BiocManager", quietly = TRUE)) {
  install.packages("BiocManager")
}
BiocManager::install("AnnotationHub")
BiocManager::install("biomaRt")

library(AnnotationHub)
library(biomaRt)

# Use the appropriate Ensembl database for human genes
ensembl <- useMart("ensembl", dataset = "hsapiens_gene_ensembl")

# Get the list of all protein-coding genes
genes <- getBM(attributes = c("ensembl_gene_id", "external_gene_name"),
               filters = "biotype",
               values = "protein_coding",
               mart = ensembl)

# Create an AnnotationHub object for Pfam annotations
dir.create(path = "~/.AnnotationHub")
options(AnnotationHub.cache = "~/.AnnotationHub")

ahub <- AnnotationHub()

# Retrieve Pfam annotations
pfam_key <- "AH73911"
pfam_annotations <- query(ahub, keys = genes$ensembl_gene_id, columns = c("PFAM_ID", "GENEID"), keytype = "ENSEMBL")
pfam_annotations <- merge(genes, pfam_annotations, by.x = "ensembl_gene_id", by.y = "QUERYID", all.x = TRUE)

# View the resulting data frame
print(pfam_annotations)


```

